<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hello World</title>
    <style>
      :root {
        color-scheme: light dark;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background-color: Canvas;
        color: CanvasText;
      }
      body {
        display: grid;
        place-items: center;
        min-height: 100vh;
        margin: 0;
      }
      h1 {
        font-size: clamp(2.5rem, 5vw, 4rem);
        font-weight: 700;
      }
    </style>
  </head>
  <body>
    <button id="speakButton" type="button">Speak Hello World</button>
    <p id="status" role="status" aria-live="polite"></p>
    <script>
      const statusEl = document.getElementById("status");
      const speakButton = document.getElementById("speakButton");
      const setStatus = (message, isError = false) => {
        if (!statusEl) return;
        statusEl.textContent = message;
        statusEl.style.color = isError ? "crimson" : "";
      };

      const setError = (message) => {
        console.error(message);
        setStatus(message, true);
      };

      const setButtonEnabled = (enabled) => {
        if (!speakButton) return;
        speakButton.disabled = !enabled;
      };

      const startSpeech = () => {
        if (!speakButton) {
          setError("Speak button is missing from the page.");
          return;
        }

        setButtonEnabled(false);
        const utterance = new SpeechSynthesisUtterance("Hello World");

        utterance.onstart = () => setStatus("Speech playback started.");
        utterance.onend = () => {
          setStatus("Speech playback finished.");
          setButtonEnabled(true);
          speakButton.focus();
        };
        utterance.onerror = (event) => {
          setError(`Speech synthesis error: ${event.error || "unknown"}`);
          setButtonEnabled(true);
        };

        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(utterance);
      };

      document.addEventListener("DOMContentLoaded", () => {
        if (!speakButton) {
          setError("Speak button is missing from the page.");
          return;
        }

        if (!("speechSynthesis" in window)) {
          setError("Speech synthesis is not supported in this browser.");
          setButtonEnabled(false);
          return;
        }

        setStatus("Press the button to hear 'Hello World'.");

        speakButton.addEventListener("click", () => {
          try {
            startSpeech();
          } catch (error) {
            const message =
              error instanceof Error ? error.message : String(error ?? "unknown error");
            setError(`Unable to start speech: ${message}`);
            setButtonEnabled(true);
          }
        });
      });
    </script>
  </body>
</html>
